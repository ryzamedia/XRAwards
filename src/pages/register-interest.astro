---
/**
 * Register Interest Page
 * URL: /register-interest
 * For people who want to register their interest in the XR Awards
 */
export const prerender = true;

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CTAFooter from '../components/CTAFooter.astro';
// import Button from '../components/Button.astro'; // Unused import
import { supabase } from '../utils/supabase';

// Fetch active event details
const { data: eventDetails } = await supabase
  .from('event_details')
  .select('*')
  .eq('is_active', true)
  .single();
---

<Layout
  title={`Register Your Interest - ${eventDetails?.event_name || 'XR Awards Gala'} - AIXR XR Awards`}
  description={`Register your interest in the ${eventDetails?.event_name || 'XR Awards Gala'}. Stay updated on nominations, key dates, and exclusive opportunities to showcase your XR innovation.`}
>
  <Header />
  
  <main class="min-h-screen bg-white">
    <!-- Register Interest Header -->
    <section class="relative bg-[#0E1022] pt-32 md:pt-40 pb-20 md:pb-32 overflow-hidden">
      <!-- Decorative Background Rings -->
      <!-- Left Ring - Offset Up with Gradient -->
      <div class="absolute -left-20 md:left-0 top-1/4 -translate-y-1/2 -translate-x-1/2 w-[300px] h-[300px] md:w-[450px] md:h-[450px]">
        <div class="absolute inset-0 rounded-full" style="background: linear-gradient(180deg, #E91E8C 0%, #5D1635 100%);"></div>
        <div class="absolute top-[55px] left-[55px] right-[55px] bottom-[55px] md:top-[75px] md:left-[75px] md:right-[75px] md:bottom-[75px] rounded-full bg-[#0E1022]"></div>
      </div>
      <!-- Right Ring - Offset Down with Gradient -->
      <div class="absolute -right-20 md:right-0 top-3/4 -translate-y-1/2 translate-x-1/2 w-[300px] h-[300px] md:w-[450px] md:h-[450px]">
        <div class="absolute inset-0 rounded-full" style="background: linear-gradient(180deg, #00D4D8 0%, #0A4B52 100%);"></div>
        <div class="absolute top-[55px] left-[55px] right-[55px] bottom-[55px] md:top-[75px] md:left-[75px] md:right-[75px] md:bottom-[75px] rounded-full bg-[#0E1022]"></div>
      </div>
      
      <!-- Content -->
      <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="register-interest-title text-white mb-6">
          Register Your Interest
        </h1>
        
        <!-- Decorative Dots -->
        <div class="flex justify-center gap-2 mb-6">
          <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
          <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
          <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
          <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
          <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
        </div>
        
        <p class="register-interest-subtitle text-white">
          Stay updated on the {eventDetails?.event_name || 'XR Awards Gala'} and exclusive opportunities
        </p>
      </div>
    </section>

    <!-- Register Interest Information Section -->
    <section class="py-16" style="background-color: #F2F2F2;">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
          
          <!-- Left Column - Main Content -->
          <div>
            <!-- What You'll Get -->
            <div class="mb-12">
              <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">
                What You'll Get:
              </h2>
              <div class="space-y-4 text-gray-700">
                <p class="text-lg">
                  Register your interest to stay informed about the {eventDetails?.event_name || 'XR Awards Gala'} and receive exclusive updates about nominations, key dates, and special opportunities.
                </p>
                <ul class="space-y-4">
                  <li class="flex gap-3">
                    <span class="text-gray-400 mt-1">•</span>
                    <div>
                      <strong class="font-semibold text-gray-900">Early Notification:</strong> Be the first to know when nominations open and receive priority access to nomination materials.
                    </div>
                  </li>
                  <li class="flex gap-3">
                    <span class="text-gray-400 mt-1">•</span>
                    <div>
                      <strong class="font-semibold text-gray-900">Key Updates:</strong> Stay informed about important dates, category changes, and judging criteria updates.
                    </div>
                  </li>
                  <li class="flex gap-3">
                    <span class="text-gray-400 mt-1">•</span>
                    <div>
                      <strong class="font-semibold text-gray-900">Exclusive Content:</strong> Access to special webinars, nomination tips, and industry insights from past winners.
                    </div>
                  </li>
                  <li class="flex gap-3">
                    <span class="text-gray-400 mt-1">•</span>
                    <div>
                      <strong class="font-semibold text-gray-900">Networking Opportunities:</strong> Connect with other XR innovators and industry leaders in our exclusive community.
                    </div>
                  </li>
                </ul>
              </div>
            </div>

            <!-- Why Register -->
            <div class="mb-12">
              <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-6">
                Why Register Your Interest?
              </h3>
              <div class="space-y-4 text-gray-700">
                <p class="text-lg">
                  The XR Awards Gala is the world's leading celebration of VR, AR, and MR innovation. By registering your interest, you'll be part of an exclusive community of XR innovators and get early access to everything you need to prepare your nomination.
                </p>
                <p class="text-lg">
                  Whether you're planning to nominate this year or just want to stay connected with the XR community, registering your interest ensures you won't miss any important updates or opportunities.
                </p>
              </div>
            </div>

            <!-- Call to Action -->
            <div class="mt-8">
              <p class="text-lg text-gray-700 mb-6">
                Join thousands of XR professionals who are already registered and stay ahead of the curve in the world's most prestigious XR awards program.
              </p>
              <p class="text-lg font-bold text-gray-900">
                Register Today. Stay Informed. Be Ready to Shine.
              </p>
            </div>
          </div>

          <!-- Right Column - Registration Form -->
          <div>
            <div class="bg-gray-100 rounded-lg p-6 lg:p-8 sticky top-24">
              <div class="flex items-center gap-3 mb-6">
                <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-semibold text-sm">1</div>
                <h3 class="text-xl font-bold text-gray-900">
                  Contact Information
                </h3>
              </div>
              
              <form id="register-interest-form" class="space-y-6">
                <!-- Name Fields -->
                <div>
                  <label class="block text-sm font-bold text-gray-900 mb-2">
                    Name (Required)
                  </label>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="block text-xs text-gray-600 mb-1">First</label>
                      <input 
                        type="text" 
                        name="firstName"
                        id="firstName"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4923EB] focus:border-transparent"
                        placeholder=""
                        required
                      />
                    </div>
                    <div>
                      <label class="block text-xs text-gray-600 mb-1">Last</label>
                      <input 
                        type="text" 
                        name="lastName"
                        id="lastName"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4923EB] focus:border-transparent"
                        placeholder=""
                        required
                      />
                    </div>
                  </div>
                </div>

                <!-- Email Field -->
                <div>
                  <label class="block text-sm font-bold text-gray-900 mb-2">
                    Email (Required)
                  </label>
                  <input 
                    type="email" 
                    name="email"
                    id="email"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4923EB] focus:border-transparent"
                    placeholder=""

                    required
                  />
                </div>

                <!-- Phone Field -->
                <div>
                  <label class="block text-sm font-bold text-gray-900 mb-2">
                    Phone
                  </label>
                  <input
                    type="tel"
                    name="phone"
                    id="ri-phone"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4923EB] focus:border-transparent"
                  />
                </div>

                <!-- Submit Button -->
                <button 
                  type="submit"
                  id="submit-btn"
                  class="w-full bg-[#4923EB] text-white font-medium py-3 px-6 rounded-lg hover:bg-[#3a1bb8] transition-colors focus:outline-none focus:ring-2 focus:ring-[#4923EB] focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span id="submit-text">Register Interest</span>
                  <span id="loading-text" class="hidden">Submitting...</span>
                </button>

                <!-- Success/Error Messages -->
                <div id="form-message" class="hidden text-sm font-medium"></div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- CTA Section -->
    <CTAFooter />
  </main>

  <Footer />
</Layout>

<style>
  .register-interest-title {
    font-size: 35px;
    font-weight: 600;
  }

  .register-interest-subtitle {
    font-size: 16px;
    font-weight: 300;
    font-family: "IBM Plex Mono", monospace;
  }

  /* intl-tel-input full width */
  .iti {
    width: 100%;
  }
</style>

<script>
  import intlTelInput from 'intl-tel-input';
  import 'intl-tel-input/build/css/intlTelInput.css';

  let riIti: ReturnType<typeof intlTelInput> | null = null;

  document.addEventListener('astro:page-load', function() {
    const form = document.getElementById('register-interest-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const submitText = document.getElementById('submit-text');
    const loadingText = document.getElementById('loading-text');
    const formMessage = document.getElementById('form-message');
    const phoneInput = document.getElementById('ri-phone') as HTMLInputElement;

    if (!form || !submitBtn || !submitText || !loadingText || !formMessage) {
      console.error('Required form elements not found');
      return;
    }

    // Initialize intl-tel-input
    if (phoneInput) {
      riIti?.destroy();
      riIti = intlTelInput(phoneInput, {
        initialCountry: 'gb',
        loadUtils: () => import('intl-tel-input/utils'),
      });
    }

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      // Get form data
      const formData = new FormData(form);
      const firstName = formData.get('firstName')?.toString().trim();
      const lastName = formData.get('lastName')?.toString().trim();
      const email = formData.get('email')?.toString().trim();
      const phone = riIti ? riIti.getNumber() : '';

      const data = {
        type: 'register_interest',
        firstName,
        lastName,
        email,
        phone: phone || undefined
      };

      // Show loading state
      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      loadingText.classList.remove('hidden');
      formMessage.classList.add('hidden');

      try {
        const response = await fetch(`${import.meta.env.PUBLIC_SUPABASE_URL}/functions/v1/brevo-forms`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${import.meta.env.PUBLIC_SUPABASE_ANON_KEY}`
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          // Show success message
          formMessage.textContent = 'Thank you! Your interest has been registered successfully.';
          formMessage.className = 'text-green-600 text-sm font-medium';
          formMessage.classList.remove('hidden');
          
          // Reset form
          form.reset();
        } else {
          // Show error message
          formMessage.textContent = result.error || 'Something went wrong. Please try again.';
          formMessage.className = 'text-red-600 text-sm font-medium';
          formMessage.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Form submission error:', error);
        formMessage.textContent = 'Something went wrong. Please try again.';
        formMessage.className = 'text-red-600 text-sm font-medium';
        formMessage.classList.remove('hidden');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        loadingText.classList.add('hidden');
      }
    });
  });
</script>
